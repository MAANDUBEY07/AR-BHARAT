<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AR Bharat - Preserving Indian Heritage Through Technology</title>
  <script>
    // --- Utilities: settings persistence ---
    const persistKeys = [
      'rows','cols','spacing','mode','grid_rows','grid_cols','simplicity','symmetry','grid_type',
      'matrix_json','matrix_color','matrix_spacing','matrix_lw','prop_n','prop_showdots',
      'max_contours','canny1','canny2','min_area','simplify','thresh_block','thresh_C','retrieve_mode','resample_step','smooth_alpha',
      'top_k','min_component_area'
    ];
    function saveSetting(id) {
      const el = document.getElementById(id);
      if (!el) return;
      let v = el.type === 'checkbox' ? (el.checked ? '1' : '0') : el.value;
      try { localStorage.setItem('kolam.' + id, v); } catch {}
    }
    function loadSetting(id, def) {
      try {
        const el = document.getElementById(id);
        if (!el) return;
        const v = localStorage.getItem('kolam.' + id);
        if (v == null) { if (def != null) { if (el.type === 'checkbox') el.checked = !!def; else el.value = def; } return; }
        if (el.type === 'checkbox') el.checked = (v === '1'); else el.value = v;
      } catch {}
    }
    function wirePersistence() {
      persistKeys.forEach((k)=>{
        const el = document.getElementById(k);
        if (el) el.addEventListener('change', ()=> saveSetting(k));
      });
    }

    async function generateKolam() {
      const rows = parseInt(document.getElementById('rows').value) || 6;
      const cols = parseInt(document.getElementById('cols').value) || 6;
      const spacing = parseFloat(document.getElementById('spacing').value) || 40;
      const body = { rows, cols, spacing, grid_type: 'square', style: 'traditional' };
      const res = await fetch((window.API_BASE||'') + '/api/generate', {
        method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body)
      });
      const data = await res.json();
      await loadGallery();
      document.getElementById('current').innerHTML = data.svg;
      document.getElementById('chat-output').textContent = '';
      window.currentMeta = data.metadata;
    }

    async function convertImage() {
      const fileInput = document.getElementById('imgfile');
      if (!fileInput.files || !fileInput.files[0]) { alert('Choose an image first'); return; }
      const form = new FormData();
      form.append('file', fileInput.files[0]);
      form.append('mode', document.getElementById('mode').value || 'vector');
      // Optional params (tweak if needed)
      form.append('max_contours', document.getElementById('max_contours').value || '3');
      form.append('canny1', document.getElementById('canny1').value || '100');
      form.append('canny2', document.getElementById('canny2').value || '200');
      form.append('min_area', document.getElementById('min_area').value || '100');
      form.append('simplify', document.getElementById('simplify').value || '0.01');
      // vector params
      form.append('thresh_block', document.getElementById('thresh_block').value || '21');
      form.append('thresh_C', document.getElementById('thresh_C').value || '5');
      form.append('retrieve_mode', document.getElementById('retrieve_mode').value || 'external');
      form.append('resample_step', document.getElementById('resample_step').value || '4');
      form.append('smooth_alpha', document.getElementById('smooth_alpha').value || '0.5');
      // Dot-grid creative controls
      const gRows = document.getElementById('grid_rows')?.value;
      const gCols = document.getElementById('grid_cols')?.value;
      const simplicity = document.getElementById('simplicity')?.value || 'simple';
      const symmetry = document.getElementById('symmetry')?.value || 'auto';
      const gridType = document.getElementById('grid_type')?.value || 'square';
      if (document.getElementById('mode').value === 'dl') {
        if (gRows) form.append('grid_rows', gRows);
        if (gCols) form.append('grid_cols', gCols);
        form.append('simplicity', simplicity);
        form.append('symmetry', symmetry);
        form.append('grid_type', gridType);
        // Let UI control DL params; do not force defaults here
        // New: expose DL richness controls
        const topK = document.getElementById('top_k')?.value || '24';
        const minComp = document.getElementById('min_component_area')?.value || '80';
        form.append('top_k', topK);
        form.append('min_component_area', minComp);
      }

      // show progress
      const bar = document.getElementById('progress-bar');
      if (bar) { bar.style.width = '25%'; }
      const res = await fetch((window.API_BASE||'') + '/api/convert', { method: 'POST', body: form });
      if (bar) { bar.style.width = '70%'; }
      const data = await res.json();
      if (data.error) { if (bar) { bar.style.width = '0%'; } alert('Convert failed: ' + data.error); return; }
      await loadGallery();
      document.getElementById('current').innerHTML = data.svg;
      document.getElementById('chat-output').textContent = '';
      window.currentMeta = data.metadata;
      // Auto-fill Matrix textarea with inferred M if provided
      if (data.M && Array.isArray(data.M)) {
        const ta = document.getElementById('matrix_json');
        if (ta) { ta.value = JSON.stringify(data.M); saveSetting('matrix_json'); }
      }
      if (bar) { bar.style.width = '100%'; setTimeout(()=>{ bar.style.width = '0%'; }, 600); }
    }

    async function loadGallery() {
      // Main gallery
      const res = await fetch((window.API_BASE||'') + '/api/gallery?sort=recent');
      const data = await res.json();
      const list = document.getElementById('gallery');
      list.innerHTML = '';
      data.items.forEach((it) => list.appendChild(tile(it)));

      // Rails
      const resTrending = await fetch((window.API_BASE||'') + '/api/gallery?sort=trending');
      const dataTrending = await resTrending.json();
      const railTrending = document.getElementById('rail-trending');
      railTrending.innerHTML = '';
      dataTrending.items.forEach((it) => railTrending.appendChild(tile(it, true)));

      const resNew = await fetch((window.API_BASE||'') + '/api/gallery?sort=recent');
      const dataNew = await resNew.json();
      const railNew = document.getElementById('rail-new');
      railNew.innerHTML = '';
      dataNew.items.forEach((it) => railNew.appendChild(tile(it, true)));

      const railDay = document.getElementById('rail-day');
      railDay.innerHTML = '';
      data.items.slice(0, 10).forEach((it) => railDay.appendChild(tile(it, true)));
    }

    function tile(it, compact=false) {
      const div = document.createElement('div');
      div.className = 'card fade-in';
      div.innerHTML = `
        <div class="thumb">${it.svg}</div>
        <div class="meta">
          <div style="font-size:12px;opacity:.9;">${it.artist || 'Anonymous'}</div>
          <div class="actions">
            <button class="like" onclick="likeItem('${it.id}', this)">❤ ${it.likes || 0}</button>
            <button class="btn" onclick="showItem('${it.id}')">Open</button>
          </div>
        </div>
      `;
      return div;
    }

    async function likeItem(id, btn) {
      const res = await fetch(`${(window.API_BASE||'')}/api/gallery/${id}/like`, { method: 'POST' });
      const data = await res.json();
      if (data && data.likes != null) {
        btn.textContent = `❤ ${data.likes}`;
      }
    }

    async function showItem(id) {
      const res = await fetch(`${(window.API_BASE||'')}/api/gallery/${id}`);
      const data = await res.json();
      document.getElementById('current').innerHTML = data.svg;
      document.getElementById('chat-output').textContent = '';
      window.currentMeta = data.metadata;
    }

    async function askChat() {
      const q = document.getElementById('chat-input').value;
      if (!q.trim()) return;
      const output = document.getElementById('chat-output');
      output.textContent = 'Thinking...';
      const body = { message: q };
      if (window.currentMeta) body.metadata = window.currentMeta;
      try {
        const res = await fetch((window.API_BASE||'') + '/api/chat', {
          method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(body)
        });
        const data = await res.json();
        output.textContent = data.answer || 'No answer';
      } catch (e) {
        output.textContent = 'Error: ' + e.message;
      }
      document.getElementById('chat-input').value = '';
    }

    async function reconstructKolam() {
      const fileInput = document.getElementById('reconstruct-file');
      if (!fileInput.files || !fileInput.files[0]) { 
        alert('Please choose a Kolam image first'); 
        return; 
      }
      
      const form = new FormData();
      form.append('file', fileInput.files[0]);
      form.append('max_dim', document.getElementById('max-dim').value || '900');
      form.append('artist', document.getElementById('reconstruct-artist').value || 'AI Reconstructed');
      
      // Show progress
      const bar = document.getElementById('reconstruct-progress-bar');
      if (bar) { bar.style.width = '25%'; }
      
      try {
        const res = await fetch((window.API_BASE||'') + '/api/reconstruct', { 
          method: 'POST', 
          body: form 
        });
        
        if (bar) { bar.style.width = '70%'; }
        
        const data = await res.json();
        
        if (data.error) { 
          if (bar) { bar.style.width = '0%'; } 
          alert('Reconstruction failed: ' + data.error); 
          return; 
        }
        
        // Update gallery and display result
        await loadGallery();
        document.getElementById('current').innerHTML = data.svg;
        document.getElementById('chat-output').textContent = '';
        window.currentMeta = data.metadata;
        
        // Success feedback
        if (bar) { 
          bar.style.width = '100%'; 
          setTimeout(()=>{ 
            bar.style.width = '0%'; 
          }, 800); 
        }
        
        // Show success message
        const successMsg = document.createElement('div');
        successMsg.style.cssText = `
          position: fixed; top: 20px; right: 20px; z-index: 1000;
          background: linear-gradient(135deg, var(--heritage-gold), var(--heritage-orange));
          color: white; padding: 16px 24px; border-radius: 12px;
          box-shadow: 0 8px 32px rgba(0,0,0,0.2); font-weight: 600;
          animation: slideIn 0.3s ease;
        `;
        successMsg.innerHTML = '✅ Kolam pattern successfully reconstructed!';
        document.body.appendChild(successMsg);
        setTimeout(() => document.body.removeChild(successMsg), 4000);
        
      } catch (e) {
        if (bar) { bar.style.width = '0%'; }
        alert('Network error: ' + e.message);
      }
    }

    async function drawMatrixKolam() {
      try {
        const raw = document.getElementById('matrix_json').value.trim();
        const color = document.getElementById('matrix_color').value || '#2458ff';
        const spacing = parseFloat(document.getElementById('matrix_spacing').value) || 40;
        const lw = parseFloat(document.getElementById('matrix_lw').value) || 2;
        const M = JSON.parse(raw);

        const res = await fetch((window.API_BASE||'') + '/api/draw_matrix', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ M, color, spacing, linewidth: lw, show_dots: true })
        });
        const data = await res.json();
        if (data.error) { alert('Draw failed: ' + data.error); return; }
        await loadGallery();
        document.getElementById('current').innerHTML = data.svg;
        document.getElementById('chat-output').textContent = '';
        window.currentMeta = data.metadata;
      } catch (e) {
        alert('Invalid matrix JSON: ' + e.message);
      }
    }

    async function proposeKolam(kind) {
      const n = parseInt(document.getElementById('prop_n').value) || 7;
      const spacing = parseFloat(document.getElementById('matrix_spacing').value) || 40;
      const color = document.getElementById('matrix_color').value || '#2458ff';
      const lw = parseFloat(document.getElementById('matrix_lw').value) || 2;
      const show_dots = !!document.getElementById('prop_showdots').checked;

      const url = (window.API_BASE||'') + (kind === '1d' ? '/api/propose/1d' : '/api/propose/2d');
      const res = await fetch(url, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ n, spacing, color, linewidth: lw, show_dots })
      });
      const data = await res.json();
      if (data.error) { alert('Propose failed: ' + data.error); return; }
      await loadGallery();
      document.getElementById('current').innerHTML = data.svg;
      document.getElementById('chat-output').textContent = '';
      window.currentMeta = data.metadata;
      if (data.M) {
        document.getElementById('matrix_json').value = JSON.stringify(data.M);
      }
    }

    window.addEventListener('DOMContentLoaded', () => {
      // Point frontend to backend host/port of the current page
      const origin = window.location.origin;
      // If we are served under /app, API is same origin
      window.API_BASE = origin.includes('/app') ? origin.split('/app')[0] : origin;

      // Load settings
      persistKeys.forEach(k => loadSetting(k));
      wirePersistence();

      // Default mode to DL if no persisted value
      const modeSel = document.getElementById('mode');
      if (localStorage.getItem('kolam.mode') == null) {
        modeSel.value = 'dl';
      }

      // Add smooth scrolling to nav links and update active state
      document.querySelectorAll('nav a').forEach(a => {
        a.addEventListener('click', e => {
          e.preventDefault();
          const id = a.getAttribute('href').slice(1);
          
          // Remove active class from all nav items
          document.querySelectorAll('nav a').forEach(navLink => navLink.classList.remove('active'));
          // Add active class to clicked nav item
          a.classList.add('active');
          
          document.getElementById(id).scrollIntoView({behavior: 'smooth'});
        });
      });

      loadGallery();
      // Poll for gallery updates every 30 seconds
      setInterval(loadGallery, 30000);

      // Keyboard shortcut for chat
      document.getElementById('chat-input').addEventListener('keydown', e => {
        if (e.ctrlKey && e.key === 'Enter') {
          askChat();
        }
      });
    });
  </script>
  <style>
    /* Heritage Theme */
    :root {
      --heritage-gold: #E9C46A;
      --heritage-orange: #F4A460;
      --heritage-cream: #FFF8DC;
      --heritage-brown: #8B4513;
      --heritage-dark: #2F2F2F;
      --heritage-light: #F5F5DC;
      
      --bg-hero: linear-gradient(135deg, #2F2F2F 0%, #1A1A1A 100%);
      --bg-light: #F5F5DC;
      --bg-panel: rgba(255, 248, 220, 0.95);
      --card-bg: rgba(255, 255, 255, 0.9);
      --border: rgba(233, 196, 106, 0.3);
      --border-strong: rgba(233, 196, 106, 0.6);
      --text-dark: #2F2F2F;
      --text-light: #FFF8DC;
      --text-muted: #8B4513;
      --shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
      --shadow-strong: 0 12px 48px rgba(0, 0, 0, 0.15);
    }

    * { box-sizing: border-box; }

    body { 
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
      margin: 0; 
      padding: 0; 
      background: var(--bg-light);
      color: var(--text-dark);
      line-height: 1.6;
    }

    /* Header and Navigation */
    header { 
      background: var(--bg-panel);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid var(--border);
      box-shadow: var(--shadow);
      position: sticky; 
      top: 0; 
      z-index: 100;
      padding: 16px 24px;
    }
    
    .top-nav { 
      display: flex; 
      justify-content: space-between; 
      align-items: center; 
      max-width: 1400px; 
      margin: 0 auto; 
    }
    
    .logo { 
      display: flex; 
      align-items: center; 
      gap: 12px; 
    }
    
    .logo-icon {
      width: 40px;
      height: 40px;
      background: var(--heritage-gold);
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      color: var(--heritage-dark);
      font-size: 18px;
    }
    
    .logo-text {
      font-size: 24px;
      font-weight: 700;
      background: linear-gradient(135deg, var(--heritage-gold), var(--heritage-orange));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
    }
    
    .main-nav { 
      display: flex; 
      gap: 8px; 
    }
    
    .main-nav a { 
      color: var(--text-dark);
      text-decoration: none;
      padding: 12px 20px;
      border-radius: 12px;
      font-weight: 500;
      transition: all 0.3s ease;
      position: relative;
    }
    
    .main-nav a:hover,
    .main-nav a.active { 
      background: var(--heritage-gold);
      color: var(--heritage-dark);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    /* Hero Section */
    .hero {
      background: var(--bg-hero);
      color: var(--text-light);
      text-align: center;
      padding: 80px 24px;
      position: relative;
      overflow: hidden;
    }
    
    .hero::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="heritage" patternUnits="userSpaceOnUse" width="20" height="20"><circle cx="10" cy="10" r="1" fill="%23E9C46A" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23heritage)"/></svg>');
      opacity: 0.3;
    }
    
    .hero-content {
      position: relative;
      z-index: 2;
      max-width: 1000px;
      margin: 0 auto;
    }
    
    .hero-title {
      font-size: 3.5rem;
      font-weight: 800;
      line-height: 1.1;
      margin-bottom: 24px;
      background: linear-gradient(135deg, var(--heritage-gold), var(--heritage-orange), var(--heritage-gold));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 4px 20px rgba(233, 196, 106, 0.3);
    }
    
    .hero-subtitle {
      font-size: 1.3rem;
      line-height: 1.6;
      color: var(--text-light);
      margin-bottom: 40px;
      opacity: 0.9;
      max-width: 800px;
      margin-left: auto;
      margin-right: auto;
    }
    
    .hero-buttons {
      display: flex;
      gap: 20px;
      justify-content: center;
      align-items: center;
      flex-wrap: wrap;
    }
    
    .btn-primary {
      background: linear-gradient(135deg, var(--heritage-gold), var(--heritage-orange));
      color: var(--heritage-dark);
      border: none;
      padding: 16px 32px;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 12px;
      box-shadow: 0 8px 24px rgba(233, 196, 106, 0.3);
    }
    
    .btn-primary:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 32px rgba(233, 196, 106, 0.4);
      filter: brightness(1.05);
    }
    
    .btn-secondary {
      background: transparent;
      color: var(--text-light);
      border: 2px solid var(--heritage-gold);
      padding: 14px 30px;
      border-radius: 50px;
      font-size: 1.1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s ease;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 12px;
    }
    
    .btn-secondary:hover {
      background: var(--heritage-gold);
      color: var(--heritage-dark);
      transform: translateY(-3px);
      box-shadow: 0 8px 24px rgba(233, 196, 106, 0.3);
    }
    
    /* Stats Section */
    .stats {
      background: var(--bg-light);
      padding: 60px 24px;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 32px;
      max-width: 1200px;
      margin: 0 auto;
    }
    
    .stat-card {
      background: var(--card-bg);
      padding: 32px 24px;
      border-radius: 16px;
      text-align: center;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      transition: all 0.3s ease;
    }
    
    .stat-card:hover {
      transform: translateY(-4px);
      box-shadow: var(--shadow-strong);
      border-color: var(--border-strong);
    }
    
    .stat-number {
      font-size: 3rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--heritage-gold), var(--heritage-orange));
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      margin-bottom: 8px;
      display: block;
    }
    
    .stat-label {
      font-size: 1.1rem;
      color: var(--text-muted);
      font-weight: 500;
    }
    
    /* Main Content */
    .container { 
      padding: 24px; 
      max-width: 1400px; 
      margin: 0 auto; 
    }

    .layout { 
      display: grid; 
      grid-template-columns: 1fr 400px; 
      gap: 32px; 
      align-items: start; 
    }

    /* Panels and Sections */
    .panel { 
      background: var(--bg-panel);
      border: 1px solid var(--border);
      border-radius: 16px; 
      padding: 24px; 
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      margin-bottom: 24px;
    }

    .section h2 { 
      margin: 0 0 20px; 
      font-size: 1.5rem; 
      font-weight: 700;
      background: linear-gradient(135deg, var(--heritage-gold), var(--heritage-orange));
      -webkit-background-clip: text; 
      background-clip: text; 
      color: transparent;
    }

    /* Form Controls */
    .controls { 
      display: flex; 
      gap: 16px; 
      flex-wrap: wrap; 
      align-items: flex-end; 
      margin-bottom: 20px; 
    }
    
    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
      min-width: 120px;
    }
    
    label { 
      font-weight: 600; 
      color: var(--text-muted);
      font-size: 0.95rem;
    }
    
    input, select, textarea { 
      padding: 12px 16px; 
      background: var(--card-bg);
      color: var(--text-dark);
      border: 2px solid var(--border); 
      border-radius: 12px; 
      font-size: 1rem;
      transition: all 0.3s ease;
    }
    
    input:focus, select:focus, textarea:focus { 
      border-color: var(--heritage-gold); 
      box-shadow: 0 0 0 3px rgba(233, 196, 106, 0.1);
      outline: none;
      background: var(--heritage-cream);
    }
    
    .btn { 
      padding: 12px 24px; 
      border: none; 
      border-radius: 12px; 
      cursor: pointer; 
      font-weight: 600;
      font-size: 1rem;
      transition: all 0.3s ease;
      background: linear-gradient(135deg, var(--heritage-gold), var(--heritage-orange));
      color: var(--heritage-dark);
      box-shadow: 0 4px 16px rgba(233, 196, 106, 0.2);
    }
    
    .btn:hover { 
      transform: translateY(-2px);
      box-shadow: 0 8px 24px rgba(233, 196, 106, 0.3);
      filter: brightness(1.05);
    }
    
    .btn:active { 
      transform: translateY(0);
    }

    /* Gallery and Cards */
    .gallery { 
      display: grid; 
      grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); 
      gap: 24px; 
    }
    
    .rail { 
      display: flex; 
      gap: 20px; 
      overflow-x: auto; 
      padding-bottom: 12px; 
      scrollbar-width: thin; 
    }

    .card { 
      background: var(--card-bg);
      border: 2px solid var(--border);
      border-radius: 16px;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      min-width: 280px;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
    }
    
    .card:hover { 
      transform: translateY(-4px);
      border-color: var(--border-strong);
      box-shadow: var(--shadow-strong);
    }
    
    .thumb { 
      background: linear-gradient(135deg, var(--heritage-cream), var(--card-bg));
      padding: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
      height: 200px;
      position: relative;
      border-bottom: 2px solid var(--border);
    }
    
    .thumb svg { 
      max-width: 100%; 
      max-height: 100%; 
      filter: drop-shadow(0 4px 12px rgba(233, 196, 106, 0.2)); 
    }

    .meta { 
      padding: 20px;
      display: flex;
      gap: 12px;
      align-items: center;
      justify-content: space-between;
      color: var(--text-muted);
    }
    
    .meta .actions { 
      display: flex;
      gap: 12px;
      align-items: center;
    }
    
    .like {
      background: transparent;
      border: 2px solid var(--border);
      color: var(--text-muted);
      padding: 6px 12px;
      border-radius: 20px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s ease;
    }
    
    .like:hover {
      border-color: var(--heritage-gold);
      color: var(--heritage-gold);
      background: rgba(233, 196, 106, 0.1);
    }
    
    /* Sidebar */
    .sidebar {
      position: sticky;
      top: 100px;
    }
    
    .current svg { 
      width: 100%; 
      height: auto; 
    }

    .chat { 
      display: flex; 
      gap: 12px; 
      margin-top: 16px; 
    }
    
    .chat input { 
      flex: 1; 
      padding: 12px 16px;
      background: var(--card-bg);
      color: var(--text-dark);
      border: 2px solid var(--border);
      border-radius: 12px;
      font-size: 1rem;
    }
    
    .chat input:focus { 
      border-color: var(--heritage-gold);
      box-shadow: 0 0 0 3px rgba(233, 196, 106, 0.1);
      outline: none;
    }
    
    .chat pre { 
      background: var(--bg-panel);
      padding: 16px;
      border-radius: 12px;
      white-space: pre-wrap;
      color: var(--text-dark);
      border: 2px solid var(--border);
      margin-top: 12px;
    }

    /* Progress Bar */
    .progress { 
      height: 6px; 
      background: var(--border);
      position: relative; 
      overflow: hidden; 
      border-radius: 6px; 
      margin-top: 8px;
    }
    
    .progress .bar { 
      position: absolute; 
      left: 0; 
      top: 0; 
      bottom: 0; 
      width: 0%; 
      background: linear-gradient(90deg, var(--heritage-gold), var(--heritage-orange));
      border-radius: 6px;
      box-shadow: 0 0 12px rgba(233, 196, 106, 0.4);
      transition: width 0.3s ease; 
    }
    
    /* Animations */
    .fade-in { 
      animation: fadeIn 0.6s ease-in; 
    }
    
    @keyframes fadeIn { 
      from { 
        opacity: 0; 
        transform: translateY(20px); 
      } 
      to { 
        opacity: 1; 
        transform: translateY(0); 
      } 
    }
    
    @keyframes slideIn {
      from { 
        transform: translateX(100%); 
        opacity: 0; 
      }
      to { 
        transform: translateX(0); 
        opacity: 1; 
      }
    }
    
    /* Responsive Design */
    @media (max-width: 1024px) {
      .layout { 
        grid-template-columns: 1fr; 
        gap: 24px;
      }
      .sidebar { 
        position: static; 
        top: auto; 
      }
      .hero-title {
        font-size: 2.5rem;
      }
      .stats-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 24px;
      }
    }

    @media (max-width: 768px) {
      .hero {
        padding: 60px 20px;
      }
      .hero-title {
        font-size: 2rem;
      }
      .hero-subtitle {
        font-size: 1.1rem;
      }
      .hero-buttons {
        flex-direction: column;
        gap: 16px;
      }
      .main-nav {
        flex-direction: column;
        gap: 4px;
      }
      .main-nav a {
        padding: 10px 16px;
      }
      .controls {
        flex-direction: column;
        align-items: stretch;
      }
      .controls > * {
        min-width: 100%;
      }
      .gallery { 
        grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); 
      }
      .card { 
        min-width: 240px; 
      }
      .stats-grid {
        grid-template-columns: 1fr;
      }
      .stat-card {
        padding: 24px 20px;
      }
    }

    @media (max-width: 480px) {
      .container {
        padding: 16px;
      }
      .panel {
        padding: 16px;
      }
      .hero-title {
        font-size: 1.8rem;
      }
      .logo-text {
        font-size: 20px;
      }
      .top-nav {
        flex-direction: column;
        gap: 16px;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <!-- Header -->
  <header>
    <div class="top-nav">
      <div class="logo">
        <div class="logo-icon">ॐ</div>
        <div class="logo-text">AR Bharat</div>
      </div>
      <nav class="main-nav">
        <a href="#hero" class="active">Home</a>
        <a href="#convert">Convert</a>
        <a href="#matrix">Matrix</a>
        <a href="#generate">Generate</a>
        <a href="#gallery">Gallery</a>
      </nav>
    </div>
  </header>

  <!-- Hero Section -->
  <section id="hero" class="hero">
    <div class="hero-content">
      <h1 class="hero-title">Preserving Indian Heritage<br>Through Technology</h1>
      <p class="hero-subtitle">
        Experience the fusion of ancient wisdom and modern innovation. Create, explore, and preserve India's rich cultural heritage through AI-powered Kolam generation and immersive AR experiences.
      </p>
      <div class="hero-buttons">
        <button class="btn-primary" onclick="document.getElementById('convert').scrollIntoView({behavior: 'smooth'})">
          🎨 START CREATING
        </button>
        <a href="#gallery" class="btn-secondary">
          👁️ EXPLORE GALLERY
        </a>
      </div>
    </div>
  </section>

  <!-- Stats Section -->
  <section class="stats">
    <div class="stats-grid">
      <div class="stat-card">
        <span class="stat-number">1,200+</span>
        <div class="stat-label">Active Users</div>
      </div>
      <div class="stat-card">
        <span class="stat-number">850+</span>
        <div class="stat-label">Kolams Created</div>
      </div>
      <div class="stat-card">
        <span class="stat-number">8+</span>
        <div class="stat-label">Heritage Sites</div>
      </div>
      <div class="stat-card">
        <span class="stat-number">25+</span>
        <div class="stat-label">Cultural Patterns</div>
      </div>
    </div>
  </section>

  <div class="container">
    <div class="layout">
      <!-- Left column: Controls & Gallery -->
      <div style="display:flex; flex-direction:column; gap:16px;">
        <!-- Convert section -->
        <section id="convert" class="section panel">
          <h2>Convert Image → Kolam</h2>
          <div class="controls">
            <div class="form-group">
              <label>Upload Image</label>
              <input id="imgfile" type="file" accept="image/*" />
            </div>
            <div class="form-group">
              <label>Mode</label>
              <select id="mode">
                <option value="dl" selected>Dot-grid (AI)</option>
                <option value="vector">Vector (smooth)</option>
                <option value="contour">Contour</option>
              </select>
            </div>
            <div class="form-group">
              <label>Grid (auto)</label>
              <div style="display:flex; gap:8px;">
                <input id="grid_rows" type="number" placeholder="auto" min="3" max="49" title="Rows (optional)" />
                <input id="grid_cols" type="number" placeholder="auto" min="3" max="49" title="Cols (optional)" />
              </div>
            </div>
            <div class="form-group">
              <label>Simplicity</label>
              <select id="simplicity">
                <option value="simple" selected>Simple</option>
                <option value="medium">Medium</option>
                <option value="complex">Complex</option>
              </select>
            </div>
            <div class="form-group">
              <label>Symmetry</label>
              <select id="symmetry">
                <option value="auto" selected>Auto</option>
                <option value="rotational">Rotational</option>
                <option value="mirrored">Mirrored</option>
                <option value="free">Free-form</option>
              </select>
            </div>
            <div class="form-group">
              <label>Grid Type</label>
              <select id="grid_type">
                <option value="square" selected>Square</option>
                <option value="hex">Hexagonal</option>
              </select>
            </div>
            <div class="form-group">
              <label style="visibility:hidden;">Action</label>
              <button class="btn" onclick="convertImage()">Convert</button>
              <div class="progress"><div id="progress-bar" class="bar"></div></div>
            </div>
          </div>

          <details class="panel" style="margin-top:8px;">
            <summary style="cursor:pointer; font-weight:600;">Advanced</summary>
            <div class="controls" style="margin-top:8px;">
              <label>Contours <input id="max_contours" type="number" value="10" /></label>
              <label>Canny1 <input id="canny1" type="number" value="100" /></label>
              <label>Canny2 <input id="canny2" type="number" value="200" /></label>
              <label>Min area <input id="min_area" type="number" value="800" /></label>
              <label>Simplify <input id="simplify" type="number" step="0.005" value="0.01" /></label>
            </div>
            <div class="controls">
              <label>Thresh block <input id="thresh_block" type="number" value="31" /></label>
              <label>Thresh C <input id="thresh_C" type="number" value="3" /></label>
              <label>Retrieve <input id="retrieve_mode" type="text" value="tree" /></label>
              <label>Resample <input id="resample_step" type="number" value="8" /></label>
              <label>Smooth α <input id="smooth_alpha" type="number" step="0.1" value="0.8" /></label>
            </div>
            <div class="controls">
              <label>DL top_k <input id="top_k" type="number" value="24" /></label>
              <label>DL min area (component) <input id="min_component_area" type="number" value="80" /></label>
            </div>
          </details>
        </section>

        <!-- AI Reconstruction section -->
        <section id="reconstruct" class="section panel">
          <h2>🤖 AI Kolam Reconstruction</h2>
          <p style="color: var(--text-muted); margin-bottom: 16px; font-size: 0.95rem;">
            Advanced computer vision technology that automatically detects dots and reconstructs authentic Kolam patterns from traditional images.
          </p>
          <div class="controls">
            <div class="form-group">
              <label>Upload Traditional Kolam Photo</label>
              <input id="reconstruct-file" type="file" accept="image/*" />
            </div>
            <div class="form-group">
              <label>Max Resolution</label>
              <select id="max-dim">
                <option value="600">600px (Fast)</option>
                <option value="900" selected>900px (Balanced)</option>
                <option value="1200">1200px (High Quality)</option>
              </select>
            </div>
            <div class="form-group">
              <label>Artist Credit</label>
              <input id="reconstruct-artist" type="text" placeholder="Traditional/Anonymous" value="AI Reconstructed" />
            </div>
            <div class="form-group">
              <label style="visibility:hidden;">Action</label>
              <button class="btn btn-primary" onclick="reconstructKolam()" style="background: linear-gradient(135deg, var(--heritage-gold), var(--heritage-orange)); color: white;">
                🔍 Reconstruct Pattern
              </button>
              <div class="progress"><div id="reconstruct-progress-bar" class="bar"></div></div>
            </div>
          </div>
          <div style="background: rgba(233, 196, 106, 0.1); padding: 16px; border-radius: 8px; margin-top: 12px; font-size: 0.9rem;">
            <strong>🎯 How it works:</strong>
            <ul style="margin: 8px 0 0 20px;">
              <li>Detects kolam dots using advanced Hough Circle detection</li>
              <li>Estimates grid spacing and builds rectangular patterns</li>
              <li>Analyzes line connections through intelligent sampling</li>
              <li>Generates precise SVG with traditional aesthetics</li>
            </ul>
          </div>
        </section>

        <!-- Matrix section -->
        <section id="matrix" class="section panel">
          <h2>Draw / Propose (Matrix)</h2>
          <div class="controls">
            <div class="form-group" style="flex: 2; min-width: 300px;">
              <label>Matrix M (JSON, e.g. [[0,1,0],[1,2,1],[0,1,0]])</label>
              <textarea id="matrix_json" rows="3"></textarea>
            </div>
            <div class="form-group">
              <label>Line color</label>
              <input id="matrix_color" type="color" value="#2458ff" style="width:120px; height:48px;"/>
            </div>
            <div class="form-group">
              <label>Spacing</label>
              <input id="matrix_spacing" type="number" value="40" />
            </div>
            <div class="form-group">
              <label>Line width</label>
              <input id="matrix_lw" type="number" value="2" step="0.5" />
            </div>
            <div class="form-group">
              <label>Propose N</label>
              <input id="prop_n" type="number" value="7" min="3" max="49" />
            </div>
            <div class="form-group">
              <label>Show dots</label>
              <input id="prop_showdots" type="checkbox" />
            </div>
          </div>
          <div style="display:flex; gap:12px; flex-wrap:wrap; margin-top: 16px;">
            <button class="btn" onclick="drawMatrixKolam()">Draw Matrix</button>
            <button class="btn" onclick="proposeKolam('1d')">Propose 1D</button>
            <button class="btn" onclick="proposeKolam('2d')">Propose 2D</button>
          </div>
        </section>

        <!-- Generate section -->
        <section id="generate" class="section panel">
          <h2>Generate (Grid)</h2>
          <div class="controls">
            <div class="form-group">
              <label>Rows</label>
              <input id="rows" type="number" value="6" />
            </div>
            <div class="form-group">
              <label>Cols</label>
              <input id="cols" type="number" value="6" />
            </div>
            <div class="form-group">
              <label>Spacing</label>
              <input id="spacing" type="number" value="40" />
            </div>
            <div class="form-group">
              <label style="visibility:hidden;">Action</label>
              <button class="btn" onclick="generateKolam()">Generate Kolam</button>
            </div>
          </div>
        </section>

        <!-- Discovery Rails -->
        <section id="gallery" class="section panel" style="margin-bottom:0;">
          <h2>Gallery</h2>
          <div class="panel" style="margin-bottom:12px;">
            <h3 class="section">Trending Kolams</h3>
            <div id="rail-trending" class="rail"></div>
          </div>
          <div class="panel" style="margin-bottom:12px;">
            <h3 class="section">Newly Converted Designs</h3>
            <div id="rail-new" class="rail"></div>
          </div>
          <div class="panel" style="margin-bottom:12px;">
            <h3 class="section">Today’s Picks</h3>
            <div id="rail-day" class="rail"></div>
          </div>
          <div class="panel">
            <h3 class="section">All Items</h3>
            <div id="gallery" class="gallery"></div>
          </div>
        </section>
      </div>

      <!-- Right column: Current & Chat -->
      <aside class="sidebar">
        <div class="panel">
          <h2>Current</h2>
          <div id="current" class="current" style="min-height:250px; border: 2px solid var(--border); border-radius: 12px; padding: 20px; background: var(--heritage-cream);"></div>
          <div class="chat">
            <input id="chat-input" type="text" placeholder="Ask about the current kolam..." />
            <button class="btn" onclick="askChat()">Ask</button>
          </div>
          <pre id="chat-output"></pre>
        </div>
      </aside>
    </div>
  </div>
</body>
</html>